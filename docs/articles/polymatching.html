<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Polymatching • Polymatching</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Polymatching">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Polymatching</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/background.html">Background</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/polymatching.html">Polymatching</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/balance.html">Balance</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> Functions</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gnattino/polymatching"><span class="fa fa-github fa-lg"></span> Github</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Polymatching</h1>
            
      

      <div class="d-none name"><code>polymatching.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-algorithm-a-brief-overview">The algorithm: a brief overview<a class="anchor" aria-label="anchor" href="#the-algorithm-a-brief-overview"></a>
</h2>
<p>The polymatching algorithm is organized in two main stages. First, a
starting matched sample is generated to initialize the algorithm.
Second, an iterative procedure is applied to reduce the distance within
matched sets, thus improving the quality of the solution.</p>
<p>For the initialization of the first matched sample, this package
implements a sequential strategy. The units of the first two groups are
optimally matched. Then, the units from the third group are optimally
matched to the existing pairs. The units from the fourth group are then
optimally matched to the existing triplets, and so on. Note that, at
each step, the existing two-group optimal matching procedure can be
applied because each problem can be addressed by a two-group matching
algorithm (matching units to fixed pairs, units to fixed triplets and so
on). The order of the considered groups can be specified by the user or,
by default, is based on their size, sequentially matching groups from
the smallest to the largest. Furthermore, the package enables user to
provide any given matched set as starting point, so that the algorithm
can explore any improvement in terms of total distance.</p>
<p>The second stage of the algorithm is the iterative procedure. For
example, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
groups, the algorithm starts by relaxing the linkage with the first
group and the units of this group are rematched to the fixed
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(K-1)</annotation></semantics></math>-uples.
The procedure is repeated for each of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
groups and the attained total distance is recorded. If any newly
generated matched set improves the total distance, the matched sample
attaining the smallest total distance is selected and the iterations
continue. Again, the linkage to each group is sequentially relaxed and
possible reductions in the total distance are explored. The algorithm
stops when no improvement in the total distance is found.</p>
</div>
<div class="section level2">
<h2 id="a-toy-dataset">A toy dataset<a class="anchor" aria-label="anchor" href="#a-toy-dataset"></a>
</h2>
<p>To showcase the functionalities of the <code>polymatching</code>
package, let’s start by generating a toy dataset with 3 continuous
variables
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mn>1</mn></msub><annotation encoding="application/x-tex">X_1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mn>2</mn></msub><annotation encoding="application/x-tex">X_2</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mn>3</mn></msub><annotation encoding="application/x-tex">X_3</annotation></semantics></math>),
one binary variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>)
and one categorical variable
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>),
with four levels. The units are divided in 4 groups, labeled as A, B, C
and D, with different size
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>A</mi></msub><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">n_A = 10</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>B</mi></msub><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">n_B = 100</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mi>C</mi></msub><mo>=</mo><msub><mi>n</mi><mi>D</mi></msub><mo>=</mo><mn>500</mn></mrow><annotation encoding="application/x-tex">n_C = n_D = 500</annotation></semantics></math>).
Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
be the name of the variable identifying the assigned group.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Set seed for reproducibility of results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Group sizes</span></span>
<span><span class="va">n_A</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">n_B</span> <span class="op">&lt;-</span> <span class="fl">750</span></span>
<span><span class="va">n_C</span> <span class="op">&lt;-</span> <span class="va">n_D</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co">#Generate variables separately for each group</span></span>
<span><span class="va">dat_A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_A</span>, mean <span class="op">=</span> <span class="fl">0</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                    X_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_A</span>, mean <span class="op">=</span> <span class="fl">5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                    X_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_A</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                    Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_A</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="va">n_A</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.25</span>, <span class="fl">.25</span>, <span class="fl">.25</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, </span>
<span>                                     MARGIN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                                     FUN <span class="op">=</span> <span class="va">which</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    G <span class="op">=</span> <span class="st">"A"</span>,</span>
<span>                    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_B</span>, mean <span class="op">=</span> <span class="fl">0</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   X_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_B</span>, mean <span class="op">=</span> <span class="fl">5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   X_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_B</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_B</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="va">n_A</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.25</span>, <span class="fl">.25</span>, <span class="fl">.25</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, </span>
<span>                                     MARGIN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                                     FUN <span class="op">=</span> <span class="va">which</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   G <span class="op">=</span> <span class="st">"B"</span>,</span>
<span>                   stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_C</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   X_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_C</span>, mean <span class="op">=</span> <span class="fl">4.5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   X_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_C</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">4.5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_C</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="va">n_A</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.2</span>, <span class="fl">.3</span>, <span class="fl">.4</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, </span>
<span>                                     MARGIN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                                     FUN <span class="op">=</span> <span class="va">which</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   G <span class="op">=</span> <span class="st">"C"</span>,</span>
<span>                   stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>X_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_D</span>, mean <span class="op">=</span> <span class="fl">0.5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   X_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_D</span>, mean <span class="op">=</span> <span class="fl">5.5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   X_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_D</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">5.5</span>,  sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                   Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_D</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   W <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="va">n_A</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">.3</span>, <span class="fl">.2</span>, <span class="fl">.1</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, </span>
<span>                                     MARGIN <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                                     FUN <span class="op">=</span> <span class="va">which</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   G <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>                   stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dat_A</span>, <span class="va">dat_B</span>, <span class="va">dat_C</span>, <span class="va">dat_D</span><span class="op">)</span></span></code></pre></div>
<p>The following plot shows the distribution of the continuous
variables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X_1"</span>, <span class="st">"X_2"</span>, <span class="st">"X_3"</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"variable"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, group <span class="op">=</span> <span class="va">G</span>, color <span class="op">=</span> <span class="va">G</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span></span></code></pre></div>
<p><img src="polymatching_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>The distribution of the binary and categorical variables is
represented below. The two figures show a good overlap in all of the
variables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Z"</span>, <span class="st">"W"</span><span class="op">)</span>, </span>
<span>               names_to <span class="op">=</span> <span class="st">"variable"</span>, </span>
<span>               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">G</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Group"</span>, y <span class="op">=</span> <span class="st">"N"</span>, fill <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span></code></pre></div>
<p><img src="polymatching_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="getting-started-with-polymatch">Getting started with <code>polymatch</code><a class="anchor" aria-label="anchor" href="#getting-started-with-polymatch"></a>
</h2>
<p>The function <code>polymatch</code> can be used to generate matched
sets with units that are similar with respect to the desired variables.
In the simplest matched design, matched sets are made by one unit for
each group. In the simulated dataset, this means creating quadruplets
with one subject from each of the four groups. This is the default
design of <code>polymatch</code>. The following code can be used to
generate matched sets that are similar with respect to the three
continuous variables
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mn>1</mn></msub><annotation encoding="application/x-tex">X_1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mn>2</mn></msub><annotation encoding="application/x-tex">X_2</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mn>3</mn></msub><annotation encoding="application/x-tex">X_3</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">polymatching</span><span class="op">)</span></span>
<span><span class="va">result_match_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polymatch.html">polymatch</a></span><span class="op">(</span><span class="va">G</span> <span class="op">~</span> <span class="va">X_1</span> <span class="op">+</span> <span class="va">X_2</span> <span class="op">+</span> <span class="va">X_3</span>, </span>
<span>                        data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                        distance <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Conditional optimal matching algorithm</span></span>
<span><span class="co">## Number of observations:  2800 </span></span>
<span><span class="co">## Number of groups:  4 </span></span>
<span><span class="co">## Total distance of starting matched sample:  88.663 </span></span>
<span><span class="co">## Ended iteration  1  - total distance: 87.388 </span></span>
<span><span class="co">## Ended iteration  2  - total distance: 86.546 </span></span>
<span><span class="co">## Ended iteration  3  - total distance: 86.246 </span></span>
<span><span class="co">## Ended iteration  4  - total distance: 86.119 </span></span>
<span><span class="co">## Ended iteration  5  - total distance: 86.057 </span></span>
<span><span class="co">## Ended iteration  6  - total distance: 85.897 </span></span>
<span><span class="co">## Ended iteration  7  - total distance: 85.871 </span></span>
<span><span class="co">## End </span></span>
<span><span class="co">## Number of iterations: 8, total distance:85.871</span></span>
<span><span class="co">## Number of matched sets:  50</span></span></code></pre>
<p>The output shows the total distance attained at each step of the
iterative process. To identify the generated sets, the IDs of the
matched sets can be added to the dataset as a new variable.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_1</span> <span class="op">&lt;-</span> <span class="va">result_match_1</span><span class="op">$</span><span class="va">match_id</span></span></code></pre></div>
<p>We can check that each group is made of four units, one from each
group. The number of matched sets is 10, as this is the size of the
smallest group.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_1</span>, </span>
<span>      <span class="va">dat</span><span class="op">$</span><span class="va">G</span>, </span>
<span>      dnn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Match ID"</span>, <span class="st">"Group"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         Group</span></span>
<span><span class="co">## Match ID A B C D</span></span>
<span><span class="co">##        1 1 1 1 1</span></span>
<span><span class="co">##        2 1 1 1 1</span></span>
<span><span class="co">##        3 1 1 1 1</span></span>
<span><span class="co">##        4 1 1 1 1</span></span>
<span><span class="co">##        5 1 1 1 1</span></span>
<span><span class="co">##        6 1 1 1 1</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="unbalanced-matched-sets">Unbalanced matched sets<a class="anchor" aria-label="anchor" href="#unbalanced-matched-sets"></a>
</h2>
<p>As the groups B, C and D are much larger than A, we can also match
multiple subjects from B, C and D to each subject in A. This can be done
with the parameter <code>vectorK</code> of the function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_match_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polymatch.html">polymatch</a></span><span class="op">(</span><span class="va">G</span> <span class="op">~</span> <span class="va">X_1</span> <span class="op">+</span> <span class="va">X_2</span> <span class="op">+</span> <span class="va">X_3</span>, </span>
<span>                        data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                        distance <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>                        vectorK <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                    <span class="st">"B"</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                    <span class="st">"C"</span> <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                                    <span class="st">"D"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Conditional optimal matching algorithm</span></span>
<span><span class="co">## Number of observations:  2800 </span></span>
<span><span class="co">## Number of groups:  4 </span></span>
<span><span class="co">## Total distance of starting matched sample:  180.687 </span></span>
<span><span class="co">## Ended iteration  1  - total distance: 174.613 </span></span>
<span><span class="co">## Ended iteration  2  - total distance: 172.622 </span></span>
<span><span class="co">## Ended iteration  3  - total distance: 171.770 </span></span>
<span><span class="co">## Ended iteration  4  - total distance: 171.084 </span></span>
<span><span class="co">## Ended iteration  5  - total distance: 170.499 </span></span>
<span><span class="co">## Ended iteration  6  - total distance: 170.457 </span></span>
<span><span class="co">## Ended iteration  7  - total distance: 170.011 </span></span>
<span><span class="co">## Ended iteration  8  - total distance: 169.903 </span></span>
<span><span class="co">## End </span></span>
<span><span class="co">## Number of iterations: 9, total distance:169.903</span></span>
<span><span class="co">## Number of matched sets:  50</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_2</span> <span class="op">&lt;-</span> <span class="va">result_match_2</span><span class="op">$</span><span class="va">match_id</span></span></code></pre></div>
<p>Now, each unit from A is matched to 2 units from B and to 3 units
from C and D.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_2</span>, </span>
<span>      <span class="va">dat</span><span class="op">$</span><span class="va">G</span>, </span>
<span>      dnn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Match ID"</span>, <span class="st">"Group"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         Group</span></span>
<span><span class="co">## Match ID A B C D</span></span>
<span><span class="co">##        1 1 2 3 3</span></span>
<span><span class="co">##        2 1 2 3 3</span></span>
<span><span class="co">##        3 1 2 3 3</span></span>
<span><span class="co">##        4 1 2 3 3</span></span>
<span><span class="co">##        5 1 2 3 3</span></span>
<span><span class="co">##        6 1 2 3 3</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="exact-matching-constraints">Exact matching constraints<a class="anchor" aria-label="anchor" href="#exact-matching-constraints"></a>
</h2>
<p>It is possible to force the algorithm to match only the units that
share the value of one variable (or multiple variables). This can be
done with the <code>exactMatch</code> parameter. With the following
code, only units with the same value in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>W</mi><annotation encoding="application/x-tex">W</annotation></semantics></math>
can be matched.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_match_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polymatch.html">polymatch</a></span><span class="op">(</span><span class="va">G</span> <span class="op">~</span> <span class="va">X_1</span> <span class="op">+</span> <span class="va">X_2</span> <span class="op">+</span> <span class="va">X_3</span>, </span>
<span>                        data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                        distance <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>                        exactMatch <span class="op">=</span> <span class="op">~</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">W</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Conditional optimal matching algorithm</span></span>
<span><span class="co">## Number of observations:  2800 </span></span>
<span><span class="co">## Number of groups:  4 </span></span>
<span><span class="co">## Total distance of starting matched sample:  198.824 </span></span>
<span><span class="co">## Ended iteration  1  - total distance: 193.142 </span></span>
<span><span class="co">## Ended iteration  2  - total distance: 189.467 </span></span>
<span><span class="co">## Ended iteration  3  - total distance: 187.170 </span></span>
<span><span class="co">## Ended iteration  4  - total distance: 185.916 </span></span>
<span><span class="co">## Ended iteration  5  - total distance: 185.225 </span></span>
<span><span class="co">## End </span></span>
<span><span class="co">## Number of iterations: 6, total distance:185.225</span></span>
<span><span class="co">## Number of matched sets:  50</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_3</span> <span class="op">&lt;-</span> <span class="va">result_match_3</span><span class="op">$</span><span class="va">match_id</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="propensity-score-matching">Propensity score matching<a class="anchor" aria-label="anchor" href="#propensity-score-matching"></a>
</h2>
<p>A popular strategy to balance multiple covariates is to match on the
propensity score. In the two-group setting, it is defined as the
probability of receiving the treatment or exposure of interest and is
commonly estimated through logistic regression. With multiple treatment
groups, it is defined as the vector of probabilities of receiving each
treatment and is generally estimated through a multinomial logistic
model.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.auckland.ac.nz/~yee/VGAM/" class="external-link">VGAM</a></span><span class="op">)</span></span>
<span><span class="va">psModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html" class="external-link">vglm</a></span><span class="op">(</span><span class="va">G</span> <span class="op">~</span> <span class="va">X_1</span> <span class="op">+</span> <span class="va">X_2</span> <span class="op">+</span> <span class="va">X_3</span> <span class="op">+</span> <span class="va">Z</span> <span class="op">+</span> <span class="va">W</span>,</span>
<span>                family <span class="op">=</span> <span class="va">multinomial</span>, </span>
<span>                data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">psModel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Call:</span></span>
<span><span class="co">## vglm(formula = G ~ X_1 + X_2 + X_3 + Z + W, family = multinomial, </span></span>
<span><span class="co">##     data = dat)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients: </span></span>
<span><span class="co">##               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept):1  2.06469    1.10818   1.863  0.06244 .  </span></span>
<span><span class="co">## (Intercept):2  5.51731    0.45581  12.105  &lt; 2e-16 ***</span></span>
<span><span class="co">## (Intercept):3  9.50965    0.53096  17.910  &lt; 2e-16 ***</span></span>
<span><span class="co">## X_1:1         -1.02026    0.15302  -6.668 2.60e-11 ***</span></span>
<span><span class="co">## X_1:2         -0.59617    0.05961 -10.000  &lt; 2e-16 ***</span></span>
<span><span class="co">## X_1:3         -1.06896    0.07168 -14.913  &lt; 2e-16 ***</span></span>
<span><span class="co">## X_2:1         -0.38721    0.15348  -2.523  0.01164 *  </span></span>
<span><span class="co">## X_2:2         -0.54746    0.06059  -9.035  &lt; 2e-16 ***</span></span>
<span><span class="co">## X_2:3         -0.98895    0.07211 -13.714  &lt; 2e-16 ***</span></span>
<span><span class="co">## X_3:1          0.43436    0.15035   2.889  0.00387 ** </span></span>
<span><span class="co">## X_3:2          0.48762    0.05869   8.309  &lt; 2e-16 ***</span></span>
<span><span class="co">## X_3:3          0.90711    0.07007  12.946  &lt; 2e-16 ***</span></span>
<span><span class="co">## Z1:1          -1.76926    0.30515  -5.798 6.71e-09 ***</span></span>
<span><span class="co">## Z1:2          -1.44146    0.12341 -11.680  &lt; 2e-16 ***</span></span>
<span><span class="co">## Z1:3          -2.70446    0.14623 -18.495  &lt; 2e-16 ***</span></span>
<span><span class="co">## W2:1           0.74380    0.38497   1.932  0.05334 .  </span></span>
<span><span class="co">## W2:2           0.94372    0.14976   6.302 2.95e-10 ***</span></span>
<span><span class="co">## W2:3           1.04912    0.19620   5.347 8.93e-08 ***</span></span>
<span><span class="co">## W3:1           0.40365    0.42168   0.957  0.33844    </span></span>
<span><span class="co">## W3:2           0.96044    0.15184   6.325 2.53e-10 ***</span></span>
<span><span class="co">## W3:3           1.53118    0.18787   8.150 3.63e-16 ***</span></span>
<span><span class="co">## W4:1           1.31575    0.43265   3.041  0.00236 ** </span></span>
<span><span class="co">## W4:2           1.79106    0.18072   9.911  &lt; 2e-16 ***</span></span>
<span><span class="co">## W4:3           3.14656    0.20647  15.240  &lt; 2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Names of linear predictors: log(mu[,1]/mu[,4]), log(mu[,2]/mu[,4]), </span></span>
<span><span class="co">## log(mu[,3]/mu[,4])</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual deviance: 4433.518 on 8376 degrees of freedom</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Log-likelihood: -2216.759 on 8376 degrees of freedom</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of Fisher scoring iterations: 6 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## No Hauck-Donner effect found in any of the estimates</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Reference group is level  4  of the response</span></span></code></pre>
<p>With 4 groups, the model estimates 4 probabilities and 3 logits
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>G</mi><mo>=</mo><mi>′</mi><mi>A</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>G</mi><mo>=</mo><mi>′</mi><mi>D</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">log(P(G='A')/P(G='D'))</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>G</mi><mo>=</mo><mi>′</mi><mi>B</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>G</mi><mo>=</mo><mi>′</mi><mi>D</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">log(P(G='B')/P(G='D'))</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>G</mi><mo>=</mo><mi>′</mi><mi>C</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>G</mi><mo>=</mo><mi>′</mi><mi>D</mi><mi>′</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">log(P(G='C')/P(G='D'))</annotation></semantics></math>).
Units are generally matched on the logits of the propensity score.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">logitPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">psModel</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">logit_AvsD</span> <span class="op">&lt;-</span> <span class="va">logitPS</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">logit_BvsD</span> <span class="op">&lt;-</span> <span class="va">logitPS</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">dat</span><span class="op">$</span><span class="va">logit_CvsD</span> <span class="op">&lt;-</span> <span class="va">logitPS</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="va">result_match_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/polymatch.html">polymatch</a></span><span class="op">(</span><span class="va">G</span> <span class="op">~</span> <span class="va">logit_AvsD</span> <span class="op">+</span> <span class="va">logit_BvsD</span> <span class="op">+</span> <span class="va">logit_CvsD</span>, </span>
<span>                            data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>                            distance <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Conditional optimal matching algorithm</span></span>
<span><span class="co">## Number of observations:  2800 </span></span>
<span><span class="co">## Number of groups:  4 </span></span>
<span><span class="co">## Total distance of starting matched sample:  72.488 </span></span>
<span><span class="co">## Ended iteration  1  - total distance: 71.590 </span></span>
<span><span class="co">## Ended iteration  2  - total distance: 70.647 </span></span>
<span><span class="co">## Ended iteration  3  - total distance: 70.106 </span></span>
<span><span class="co">## Ended iteration  4  - total distance: 69.072 </span></span>
<span><span class="co">## Ended iteration  5  - total distance: 68.989 </span></span>
<span><span class="co">## Ended iteration  6  - total distance: 68.946 </span></span>
<span><span class="co">## Ended iteration  7  - total distance: 68.933 </span></span>
<span><span class="co">## End </span></span>
<span><span class="co">## Number of iterations: 8, total distance:68.933</span></span>
<span><span class="co">## Number of matched sets:  50</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_4</span> <span class="op">&lt;-</span> <span class="va">result_match_4</span><span class="op">$</span><span class="va">match_id</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giovanni Nattino, Bo Lu, Chi Song, Henry Xiang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
