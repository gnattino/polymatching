<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Evaluating the Balance of Covariates After Matching — balance • Polymatching</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluating the Balance of Covariates After Matching — balance"><meta name="description" content="The function balance computes the standardized mean differences and the ratio of the variances among treatment groups,
before and after matching. The function computes the two measures of balance for each pair of treatment groups."><meta property="og:description" content="The function balance computes the standardized mean differences and the ratio of the variances among treatment groups,
before and after matching. The function computes the two measures of balance for each pair of treatment groups."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Polymatching</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/background.html">Background</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/polymatching.html">Polymatching</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/balance.html">Balance</a></li>
      </ul><ul class="navbar-nav"><li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> Functions</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gnattino/polymatching"><span class="fa fa-github fa-lg"></span> Github</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Evaluating the Balance of Covariates After Matching</h1>

      <div class="d-none name"><code>balance.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function <code>balance</code> computes the standardized mean differences and the ratio of the variances among treatment groups,
before and after matching. The function computes the two measures of balance for each pair of treatment groups.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">balance</span><span class="op">(</span></span>
<span>  <span class="va">formulaBalance</span>,</span>
<span>  <span class="va">match_id</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  weights_before <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weights_after <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formulabalance">formulaBalance<a class="anchor" aria-label="anchor" href="#arg-formulabalance"></a></dt>
<dd><p>Formula with form <code>group ~ x_1 + ... + x_p</code>. <code>group</code> is the variable
identifying the treatment groups/exposures. The balance is evaluated for the covariates <code>x_1</code>,...,<code>x_p</code>.
Numeric and integer variables are treated as continuous. Factor variables are treated as categorical.
Factor variables with two levels are treated as binary.</p></dd>


<dt id="arg-match-id">match_id<a class="anchor" aria-label="anchor" href="#arg-match-id"></a></dt>
<dd><p>Vector identifying the matched sets—matched units must have the same identifier. It is generated by
<code><a href="polymatch.html">polymatch</a></code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The <code>data.frame</code> object with the data.</p></dd>


<dt id="arg-weights-before">weights_before<a class="anchor" aria-label="anchor" href="#arg-weights-before"></a></dt>
<dd><p>Optional vector of weights of the observations to be considered in the unmatched dataset. To compute the
unweighted standardized mean differences, set <code>weights_before</code> to NULL (default).</p></dd>


<dt id="arg-weights-after">weights_after<a class="anchor" aria-label="anchor" href="#arg-weights-after"></a></dt>
<dd><p>Vector of weights for the matched dataset. Set it to NULL (default) to compute the
unweighted standardized mean differences.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>data.frame</code> containing the standardized differences and ratios of the variances (only for continuous
variables) for each pair of treatment groups. A graphical representation of the results can be generated with
<code><a href="plotBalance.html">plotBalance</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="polymatch.html">polymatch</a></code> to generate matched samples and <code><a href="plotBalance.html">plotBalance</a></code> to
graphically represent the indicators of balance.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Generate a datasets with group indicator and four variables:</span></span></span>
<span class="r-in"><span><span class="co">#- var1, continuous, sampled from normal distributions;</span></span></span>
<span class="r-in"><span><span class="co">#- var2, continuous, sampled from beta distributions;</span></span></span>
<span class="r-in"><span><span class="co">#- var3, categorical with 4 levels;</span></span></span>
<span class="r-in"><span><span class="co">#- var4, binary.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234567</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="fl">20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>,<span class="fl">60</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="fl">60</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  var1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span>,mean<span class="op">=</span><span class="fl">0</span>,sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>,mean<span class="op">=</span><span class="fl">1</span>,sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>,mean<span class="op">=</span><span class="op">-</span><span class="fl">1</span>,sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">20</span>,shape1<span class="op">=</span><span class="fl">1</span>,shape2<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">60</span>,shape1<span class="op">=</span><span class="fl">2</span>,shape2<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">60</span>,shape1<span class="op">=</span><span class="fl">1</span>,shape2<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  var3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">20</span>,size<span class="op">=</span><span class="fl">3</span>,prob<span class="op">=</span><span class="fl">.4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">60</span>,size<span class="op">=</span><span class="fl">3</span>,prob<span class="op">=</span><span class="fl">.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">60</span>,size<span class="op">=</span><span class="fl">3</span>,prob<span class="op">=</span><span class="fl">.3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  var4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">20</span>,size<span class="op">=</span><span class="fl">1</span>,prob<span class="op">=</span><span class="fl">.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">60</span>,size<span class="op">=</span><span class="fl">1</span>,prob<span class="op">=</span><span class="fl">.3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">60</span>,size<span class="op">=</span><span class="fl">1</span>,prob<span class="op">=</span><span class="fl">.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Match on propensity score</span></span></span>
<span class="r-in"><span><span class="co">#-------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#With multiple groups, need a multinomial model for the PS</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.auckland.ac.nz/~yee/VGAM/" class="external-link">VGAM</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: stats4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: splines</span>
<span class="r-in"><span><span class="va">psModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html" class="external-link">vglm</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">var1</span> <span class="op">+</span> <span class="va">var2</span> <span class="op">+</span> <span class="va">var3</span> <span class="op">+</span> <span class="va">var4</span>,</span></span>
<span class="r-in"><span>                family<span class="op">=</span><span class="va">multinomial</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#Estimated probabilities - 3 for each unit: P(group=A), P(group=B), P(group=C)</span></span></span>
<span class="r-in"><span><span class="va">probsPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">psModel</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">probA</span> <span class="op">&lt;-</span> <span class="va">probsPS</span><span class="op">[</span>,<span class="st">"A"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">probB</span> <span class="op">&lt;-</span> <span class="va">probsPS</span><span class="op">[</span>,<span class="st">"B"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">probC</span> <span class="op">&lt;-</span> <span class="va">probsPS</span><span class="op">[</span>,<span class="st">"C"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">#Estimated logits - 2 for each unit: log(P(group=A)/P(group=C)), log(P(group=B)/P(group=C))</span></span></span>
<span class="r-in"><span><span class="va">logitPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">psModel</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">logit_AvsC</span> <span class="op">&lt;-</span> <span class="va">logitPS</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">logit_BvsC</span> <span class="op">&lt;-</span> <span class="va">logitPS</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Match on logits of PS</span></span></span>
<span class="r-in"><span><span class="va">resultPs</span> <span class="op">&lt;-</span> <span class="fu"><a href="polymatch.html">polymatch</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">logit_AvsC</span> <span class="op">+</span> <span class="va">logit_BvsC</span>, data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>                    distance <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional optimal matching algorithm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of observations:  140 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of groups:  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total distance of starting matched sample:  37.878 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  1  - total distance: 36.229 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> End </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of iterations: 2, total distance:36.229</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of matched sets:  20 </span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_ps</span> <span class="op">&lt;-</span> <span class="va">resultPs</span><span class="op">$</span><span class="va">match_id</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Evaluate balance in covariates</span></span></span>
<span class="r-in"><span><span class="va">tabBalancePs</span> <span class="op">&lt;-</span> <span class="fu">balance</span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">var1</span> <span class="op">+</span> <span class="va">var2</span> <span class="op">+</span> <span class="va">var3</span> <span class="op">+</span> <span class="va">var4</span>,</span></span>
<span class="r-in"><span>                        match_id <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">match_id_ps</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tabBalancePs</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    groups variable        type stdzDiffPre ratioVarsPre stdzDiffPost</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     A-B     var1  continuous -0.51757085     4.425458   0.18521887</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     A-C     var1  continuous  0.70879687     4.331368  -0.09488064</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     B-C     var1  continuous  0.96044832     1.021723  -0.21982348</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     A-B     var2  continuous -0.31012062     1.089382  -0.05870530</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     A-C     var2  continuous  0.88429601     1.167713   0.15711852</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     B-C     var2  continuous  1.22693868     1.071905   0.22174525</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7     A-B     var3 categorical  1.24193881           NA   0.82499540</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     A-C     var3 categorical  0.41021435           NA   0.84149879</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     B-C     var3 categorical  1.51855778           NA   0.24408401</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    A-B     var4      binary  0.79026333           NA   0.43105272</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    A-C     var4      binary -0.03514727           NA   0.21088361</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12    B-C     var4      binary -0.83129513           NA  -0.21685960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    ratioVarsPost</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       2.173137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       4.184995</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       1.925786</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       1.121038</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5       1.003387</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       1.117254</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9             NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10            NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11            NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12            NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#You can also represent the standardized mean differences with 'plotBalance'</span></span></span>
<span class="r-in"><span><span class="co">#plotBalance(tabBalancePs, ratioVariances = TRUE)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giovanni Nattino, Bo Lu, Chi Song, Henry Xiang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

