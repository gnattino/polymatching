<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Polymatching — polymatch • Polymatching</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Polymatching — polymatch"><meta name="description" content="polymatch generates matched samples in designs with up to 10 groups."><meta property="og:description" content="polymatch generates matched samples in designs with up to 10 groups."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Polymatching</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/background.html">Background</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/polymatching.html">Polymatching</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/balance.html">Balance</a></li>
      </ul><ul class="navbar-nav"><li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fa-file-code-o"></span> Functions</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gnattino/polymatching"><span class="fa fa-github fa-lg"></span> Github</a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Polymatching</h1>

      <div class="d-none name"><code>polymatch.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>polymatch</code> generates matched samples in designs with up to 10 groups.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">polymatch</span><span class="op">(</span></span>
<span>  <span class="va">formulaMatch</span>,</span>
<span>  start <span class="op">=</span> <span class="st">"small.to.large"</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  distance <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>  exactMatch <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vectorK <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  iterate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  niter_max <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  withinGroupDist <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formulamatch">formulaMatch<a class="anchor" aria-label="anchor" href="#arg-formulamatch"></a></dt>
<dd><p>Formula with form <code>group ~ x_1 + ... + x_p</code>, where <code>group</code> is the name of the variable
identifying the treatment groups/exposures and <code>x_1</code>,...,<code>x_p</code> are the matching variables.</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>An object specifying the starting point of the iterative algorithm. Three types of input are accepted:</p><ul><li><p><code>start="small.to.large"</code> (default): the starting matched set is generated by matching groups
from the smallest to the largest.</p></li>
<li><p>Users can specify the order to be used to match groups for the starting sample.
For example, if there are four groups with labels "A","B","C" and "D", <code>start="D-B-A-C"</code> generates the starting sample
by matching groups "D" and "B", then units from "A" to the "D"-"B"pairs, then units from "C" to the "D"-"B"-"A" triplets.</p></li>
<li><p>Users can provide the starting matched set and the algorithm will explore possible reductions in the total
distance. In this case, <code>start</code> must be a vector with the IDs of the matched sets, i.e.,
a vector with length equal to the number of rows of <code>data</code> where
matched subjects are flagged with the same value and non-matched subjects have value <code>NA</code>.</p></li>
</ul></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The <code>data.frame</code> object with the data.</p></dd>


<dt id="arg-distance">distance<a class="anchor" aria-label="anchor" href="#arg-distance"></a></dt>
<dd><p>String specifying whether the distance between pairs of observations should be computed with the
Euclidean (<code>"euclidean"</code>, default) or Mahalanobis (<code>"mahalanobis"</code>) distance. See section 'Details' for further information.</p></dd>


<dt id="arg-exactmatch">exactMatch<a class="anchor" aria-label="anchor" href="#arg-exactmatch"></a></dt>
<dd><p>Formula with form <code>~ z_1 + ... + z_k</code>, where <code>z_1</code>,...,<code>z_k</code> must
be factor variables. Subjects are exactly matched on <code>z_1</code>,...,<code>z_k</code>, i.e., matched
within levels of these variables.</p></dd>


<dt id="arg-vectork">vectorK<a class="anchor" aria-label="anchor" href="#arg-vectork"></a></dt>
<dd><p>A named vector with the number of subjects from each group in each matched set. The names of the vector must be
the labels of the groups, i.e., the levels of the variable identifying the treatment groups/exposures.
For example, in case of four groups with labels "A","B","C" and "D" and assuming that the desired design is 1:2:3:3
(1 subject from A, 2 from B, 3 from C and 3 from D in each matched set), the parameter should be set to
<code>vectorK =  c("A" = 1, "B" = 2, "C" = 3, "D" = 3)</code>. By default, the generated matched design includes 1 subject per group in each
matched set, i.e, a 1:1: ... :1 matched design.</p></dd>


<dt id="arg-iterate">iterate<a class="anchor" aria-label="anchor" href="#arg-iterate"></a></dt>
<dd><p>Boolean specifying whether iterations should be done (<code>iterate=TRUE</code>, default) or not (<code>iterate=FALSE</code>).</p></dd>


<dt id="arg-niter-max">niter_max<a class="anchor" aria-label="anchor" href="#arg-niter-max"></a></dt>
<dd><p>Maximum number of iterations. Default is 50.</p></dd>


<dt id="arg-withingroupdist">withinGroupDist<a class="anchor" aria-label="anchor" href="#arg-withingroupdist"></a></dt>
<dd><p>Boolean specifying whether the distances within the same treatment/exposure group should be considered in the
total distance. For example, in a 1:2:3 matched design among the groups A, B and C, the parameters controls whether the distance
between the two subjects in B and the three pairwise distances among the subjects in C should be counted in the total distance.
The default value is <code>TRUE</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Boolean: should text be printed in the console? Default is <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list containing the following components:</p><dl><dt>match_id</dt>
<dd><p>A numeric vector identifying the matched sets—matched units have the same identifier.</p></dd>

  <dt>total_distance</dt>
<dd><p>Total distance of the returned matched sample.</p></dd>

  <dt>total_distance_start</dt>
<dd><p>Total distance at the starting point.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function implements the conditionally optimal matching algorithm, which iteratively uses
two-group optimal matching steps to generate matched samples with small total distance. In the current implementation,
it is possible to generate matched samples with multiple subjects per group, with the matching ratio being
specified by the <code>vectorK</code> parameter.</p>
<p>The steps of the algorithm are described with the following example. Consider a 4-group design with
groups labels "A", "B", "C" and "D" and a 1:1:1:1 matching ratio. The algorithm requires a set of quadruplets as starting point.
The argument <code>start</code> defines the approach to be used to
generate such a starting point. <code>polymatch</code> generates the starting point by sequentially using optimal two-group matching.
In the default setting (<code>start="small.to.large"</code>), the steps are:</p><ol><li><p>optimally match the two smallest groups;</p></li>
<li><p>optimally match the third smallest group to the pairs generated in the first step;</p></li>
<li><p>optimally match the last group to the triplets generated in the second step.</p></li>
</ol><p>Notably, we can use the optimal two-group algorithm in steps 2) and 3) because they are
two-dimensional problems: the elements of one group on one hand, fixed matched sets on the other hand. The order of the
groups to be considered when generating the starting point can be user-specified (e.g., <code>start="D-B-A-C"</code>).
In alternative, the user can provide a matched set that will be used as starting point.</p>
<p>Given the starting matched set, the algorithm iteratively explores possible reductions in the total distance (if <code>iterate="TRUE"</code>),
by sequentially relaxing the connection to each group and rematching units of that group. In our example:</p><ol><li><p>rematch "B-C-D" triplets within the starting quadruplets to units in group "A";</p></li>
<li><p>rematch "A-C-D" triplets within the starting quadruplets to units in group "B";</p></li>
<li><p>rematch "A-B-D" triplets within the starting quadruplets to units in group "C";</p></li>
<li><p>rematch "A-B-C" triplets within the starting quadruplets to units in group "D".</p></li>
</ol><p>If none of the sets of quadruplets generated in 1)-4) has smaller total distance than the starting point, the algorihm stops.
Otherwise, the set of quadruplets with smallest distance is seleceted and the process iterated, until no reduction in the total
distance is found or the number of maximum iterations is reached (<code>niter_max=50</code> by default).</p>
<p>The total distance is defined as the sum of all the within-matched-set distances. The within-matched-set distance is defined as the
sum of the pairwise distances between pairs of units in the matched set. The type of distance is specified with the <code>distance</code>
argument. The current implementation supports Euclidean (<code>distance="euclidean"</code>) and Mahalanobis (<code>distance="mahalanobis"</code>)
distances. In particular, for the Mahalanobis distance, the covariance matrix is defined only once on the full dataset.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="balance.html">balance</a></code> and <code><a href="plotBalance.html">plotBalance</a></code> to summarize the
balance in the covariates.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Generate a datasets with group indicator and four variables:</span></span></span>
<span class="r-in"><span><span class="co">#- var1, continuous, sampled from normal distributions;</span></span></span>
<span class="r-in"><span><span class="co">#- var2, continuous, sampled from beta distributions;</span></span></span>
<span class="r-in"><span><span class="co">#- var3, categorical with 4 levels;</span></span></span>
<span class="r-in"><span><span class="co">#- var4, binary.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234567</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"A"</span>,<span class="fl">20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>,<span class="fl">60</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="fl">60</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  var1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">20</span>,mean<span class="op">=</span><span class="fl">0</span>,sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>,mean<span class="op">=</span><span class="fl">1</span>,sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>,mean<span class="op">=</span><span class="op">-</span><span class="fl">1</span>,sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  var2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">20</span>,shape1<span class="op">=</span><span class="fl">1</span>,shape2<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">60</span>,shape1<span class="op">=</span><span class="fl">2</span>,shape2<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                           <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">60</span>,shape1<span class="op">=</span><span class="fl">1</span>,shape2<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  var3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">20</span>,size<span class="op">=</span><span class="fl">3</span>,prob<span class="op">=</span><span class="fl">.4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">60</span>,size<span class="op">=</span><span class="fl">3</span>,prob<span class="op">=</span><span class="fl">.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">60</span>,size<span class="op">=</span><span class="fl">3</span>,prob<span class="op">=</span><span class="fl">.3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  var4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">20</span>,size<span class="op">=</span><span class="fl">1</span>,prob<span class="op">=</span><span class="fl">.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">60</span>,size<span class="op">=</span><span class="fl">1</span>,prob<span class="op">=</span><span class="fl">.3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                  <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fl">60</span>,size<span class="op">=</span><span class="fl">1</span>,prob<span class="op">=</span><span class="fl">.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Match on propensity score</span></span></span>
<span class="r-in"><span><span class="co">#-------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#With multiple groups, need a multinomial model for the PS</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.auckland.ac.nz/~yee/VGAM/" class="external-link">VGAM</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/VGAM/man/vglm.html" class="external-link">vglm</a></span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">var1</span> <span class="op">+</span> <span class="va">var2</span> <span class="op">+</span> <span class="va">var3</span> <span class="op">+</span> <span class="va">var4</span>,</span></span>
<span class="r-in"><span>                family<span class="op">=</span><span class="va">multinomial</span>, data<span class="op">=</span><span class="va">dat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#Estimated probabilities - 3 for each unit: P(group=A), P(group=B), P(group=C)</span></span></span>
<span class="r-in"><span><span class="va">probsPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">psModel</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">probA</span> <span class="op">&lt;-</span> <span class="va">probsPS</span><span class="op">[</span>,<span class="st">"A"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">probB</span> <span class="op">&lt;-</span> <span class="va">probsPS</span><span class="op">[</span>,<span class="st">"B"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">probC</span> <span class="op">&lt;-</span> <span class="va">probsPS</span><span class="op">[</span>,<span class="st">"C"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">#Estimated logits - 2 for each unit: log(P(group=A)/P(group=C)), log(P(group=B)/P(group=C))</span></span></span>
<span class="r-in"><span><span class="va">logitPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">psModel</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">logit_AvsC</span> <span class="op">&lt;-</span> <span class="va">logitPS</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">logit_BvsC</span> <span class="op">&lt;-</span> <span class="va">logitPS</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Match on logits of PS</span></span></span>
<span class="r-in"><span><span class="va">resultPs1</span> <span class="op">&lt;-</span> <span class="fu">polymatch</span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">logit_AvsC</span> <span class="op">+</span> <span class="va">logit_BvsC</span>, data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>                    distance <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional optimal matching algorithm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of observations:  140 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of groups:  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total distance of starting matched sample:  37.878 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  1  - total distance: 36.229 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> End </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of iterations: 2, total distance:36.229</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of matched sets:  20 </span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_ps1</span> <span class="op">&lt;-</span> <span class="va">resultPs1</span><span class="op">$</span><span class="va">match_id</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Match on probabilities</span></span></span>
<span class="r-in"><span><span class="va">resultPs2</span> <span class="op">&lt;-</span> <span class="fu">polymatch</span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">probA</span> <span class="op">+</span> <span class="va">probB</span> <span class="op">+</span> <span class="va">probC</span>, data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>                       distance <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional optimal matching algorithm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of observations:  140 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of groups:  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total distance of starting matched sample:  6.596 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  1  - total distance: 6.479 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  2  - total distance: 6.390 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  3  - total distance: 6.368 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  4  - total distance: 6.368 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  5  - total distance: 6.368 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> End </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of iterations: 6, total distance:6.368</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of matched sets:  20 </span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_ps2</span> <span class="op">&lt;-</span> <span class="va">resultPs2</span><span class="op">$</span><span class="va">match_id</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Match on covariates</span></span></span>
<span class="r-in"><span><span class="co">#--------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Match on continuous covariates only</span></span></span>
<span class="r-in"><span><span class="va">resultCov1</span> <span class="op">&lt;-</span> <span class="fu">polymatch</span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">var1</span> <span class="op">+</span> <span class="va">var2</span>, data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>                        distance <span class="op">=</span> <span class="st">"mahalanobis"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional optimal matching algorithm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of observations:  140 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of groups:  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total distance of starting matched sample:  21.572 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  1  - total distance: 21.154 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  2  - total distance: 21.140 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> End </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of iterations: 3, total distance:21.140</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of matched sets:  20 </span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_cov1</span> <span class="op">&lt;-</span> <span class="va">resultCov1</span><span class="op">$</span><span class="va">match_id</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Match on continuous covariates with exact match on categorical/binary variables</span></span></span>
<span class="r-in"><span><span class="va">resultCov2</span> <span class="op">&lt;-</span> <span class="fu">polymatch</span><span class="op">(</span><span class="va">group</span> <span class="op">~</span> <span class="va">var1</span> <span class="op">+</span> <span class="va">var2</span>, data <span class="op">=</span> <span class="va">dat</span>,</span></span>
<span class="r-in"><span>                        distance <span class="op">=</span> <span class="st">"mahalanobis"</span>,</span></span>
<span class="r-in"><span>                        exactMatch <span class="op">=</span> <span class="op">~</span><span class="va">var3</span><span class="op">+</span><span class="va">var4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Conditional optimal matching algorithm</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of observations:  140 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of groups:  3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Total distance of starting matched sample:  43.380 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  1  - total distance: 40.973 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Ended iteration  2  - total distance: 40.781 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> End </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of iterations: 3, total distance:40.781</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of matched sets:  16 </span>
<span class="r-in"><span><span class="va">dat</span><span class="op">$</span><span class="va">match_id_cov2</span> <span class="op">&lt;-</span> <span class="va">resultCov2</span><span class="op">$</span><span class="va">match_id</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Giovanni Nattino, Bo Lu, Chi Song, Henry Xiang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

